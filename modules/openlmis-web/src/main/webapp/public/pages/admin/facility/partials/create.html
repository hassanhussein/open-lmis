<!--
  ~ Copyright Â© 2013 VillageReach.  All Rights Reserved.  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  ~
  ~ If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
  -->

<div xmlns="http://www.w3.org/1999/html" tab-scroll>
<div ng-hide="facility.id"><h2 openlmis-message="create.facility.addNew"></h2></div>
<div ng-show="facility.id">
    <h2 id="edit-facility-header" openlmis-message="edit.facility.edit"></h2>
</div>

<form ng-submit="saveFacility()" id="create-facility" name="facilityForm" novalidate
      ng-disabled="facility.dataReportable == 'false'">
<div class="app-form">

<div class="form-group">

    <h3 openlmis-message="label.basicInformation"></h3>

  <div class="form-row clearfix">
    <div class="form-cell">
      <label for="code" openlmis-message="create.facility.code"><span class="label-required"> *</span></label>

            <div class="form-field">
                <input ng-model="facility.code" name="code" id="code" type="text" maxlength="50" ng-required="true"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.code.$error.required && showError"
              openlmis-message="missing.value">

        </span>
            </div>
        </div>

        <div class="form-cell">
            <label for="gln" openlmis-message="create.facility.gln"></label>

            <div class="form-field">
                <input ng-model="facility.gln" id="gln" type="text" maxlength="30"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

  <div class="form-row clearfix">
    <div class="form-cell">
      <label for="name" openlmis-message="create.facility.name"><span class="label-required"> *</span></label>

            <div class="form-field">
                <input ng-model="facility.name" name="name" id="name" type="text" maxlength="50" ng-required="true"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.name.$error.required && showError"
              openlmis-message="missing.value">

        </span>
            </div>
        </div>

    <div class="form-cell">
      <label for="facility-type" openlmis-message="create.facility.facilityType"><span class="label-required"> *</span></label>

            <div class="form-field">
                <select name="facilityType" id="facility-type" ng-model="facility.facilityType.code"
                        ng-options="i.code as i.name for i in facilityTypes" ng-required="true"
                        ng-disabled="facility.dataReportable == 'false'">
                    <option value="" openlmis-message="create.facility.select.facilityType"></option>
                </select>
        <span class="field-error" ng-show="facilityForm.facilityType.$error.required && showError"
              openlmis-message="select.value">
        </span>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="operated-by" openlmis-message="create.facility.operatedBy"></label>

            <div class="form-field">
                <select id="operated-by" ng-model="facility.operatedBy.code"
                        ng-options="i.code as i.text for i in facilityOperators"
                        ng-disabled="facility.dataReportable == 'false'">
                    <option value="" openlmis-message="create.facility.select.operatedBy"></option>
                </select>
            </div>
        </div>
    </div>

  <div class="form-row clearfix">
    <div class="form-cell">
      <label openlmis-message="create.facility.serviceDeliveryPoint"><span class="label-required"> *</span></label>

            <div class="form-field radio-group">
                <input type="radio" name="isSdp" value="true" ng-model="facility.sdp" ng-required="true"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.yes"></strong>
                &nbsp; &nbsp; &nbsp;
                <input ng-model="facility.sdp" type="radio" name="isSdp" value="false"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.no"></strong>
        <span class="field-error" ng-show="facilityForm.isSdp.$error.required && showError"
              openlmis-message="select.value">
        </span>
            </div>
        </div>

    <div class="form-cell">
      <label openlmis-message="create.facility.activeFacility"><span class="label-required"> *</span></label>

            <div class="form-field radio-group">
                <input ng-model="facility.active" type="radio" name="isActive" value="true"
                       ng-required="true" ng-disabled="facility.dataReportable == 'false'"/><strong
                    openlmis-message="button.yes"></strong> &nbsp; &nbsp;
                &nbsp;
                <input ng-model="facility.active" type="radio" name="isActive" value="false"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.no"></strong>
        <span class="field-error" ng-show="facilityForm.isActive.$error.required && showError"
              openlmis-message="select.value">
        </span>
            </div>
        </div>
    </div>

  <div class="form-row clearfix">
    <div class="form-cell">
      <label for="go-live-date" openlmis-message="create.facility.goLiveDate"><span class="label-required"> *</span></label>

            <div class="form-field">
                <input ng-model="facility.goLiveDate" name="goLiveDate" id="go-live-date" type="text"
                       value="{{facility.goLiveDate | date:'dd/MM/yyyy'}}"
                       ui-date="{dateFormat: 'dd/mm/yy', changeYear: true}"
                       readonly ng-change="blurDateFields()" ng-required="true"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.goLiveDate.$error.required && showError"
              openlmis-message="missing.value">
        </span>
            </div>
        </div>

        <div class="form-cell">
            <label for="go-down-date" openlmis-message="create.facility.goDownDate"></label>

            <div class="form-field">
                <input ng-model="facility.goDownDate" id="go-down-date" type="text"
                       value="{{facility.goDownDate | date:'dd/MM/yyyy'}}"
                       ui-date="{dateFormat: 'dd/mm/yy', changeYear: true}"
                       readonly ng-change="blurDateFields()" ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell full-width">
            <label for="description" openlmis-message="create.facility.description"></label>

            <div class="form-field">
                <input ng-model="facility.description" id="description" type="text" maxlength="250"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>
</div>
<!-- /form-group -->

<div class="form-group">
    <h3 openlmis-message="create.facility.contactInformation"></h3>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="address-1" openlmis-message="create.facility.addressLine1"></label>

            <div class="form-field">
                <input ng-model="facility.address1" id="address-1" type="text" maxlength="50"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="address-2" openlmis-message="create.facility.addressLine2"></label>

            <div class="form-field">
                <input ng-model="facility.address2" id="address-2" type="text" maxlength="50"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="main-phone" openlmis-message="create.facility.phone"></label>

            <div class="form-field">
                <input ng-model="facility.mainPhone" id="main-phone" type="text" maxlength="20"
                       ng-disabled="facility.dataReportable == 'false'"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="fax-phone" openlmis-message="create.facility.fax"></label>

            <div class="form-field">
                <input ng-model="facility.fax" id="fax-phone" type="text" maxlength="20"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>

</div>
<!-- /form-group -->

<div class="form-group">
    <h3 openlmis-message="create.facility.programsSupported"></h3>

    <div class="form-row clearfix">
        <div class="form-cell programs-table">
            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th openlmis-message="create.facility.programs"></th>
                    <th openlmis-message="create.facility.active"></th>
                    <th openlmis-message="create.facility.startDate"></th>
                    <th openlmis-message="create.facility.programType"></th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="supportedProgram in facility.supportedPrograms">
                    <td ng-bind="supportedProgram.program.name"></td>
                    <td><input ng-model="supportedProgram.active" id="" type="checkbox" value="true"
                               ng-disabled="facility.dataReportable == 'false'"/></td>
                    <td ng-init="supportedProgram.editedStartDate = supportedProgram.startDate">
                        <input type="text" value="{{supportedProgram.startDate | date: 'dd/MM/yyyy'}}"
                               ng-model="supportedProgram.editedStartDate"
                               readonly ng-disabled="facility.dataReportable == 'false'"
                               ui-date="{dateFormat:'dd/mm/yy', changeYear: true}"
                               ng-required="supportedProgram.active == true"
                               ng-change="showConfirmDateChangeWindow(supportedProgram)"/>
            <span class="field-error" ng-show="supportedProgram.active && !supportedProgram.startDate && showError"
                  openlmis-message="create.facility.mandatoryStartDate">
            </span>
                    </td>
                    <td ng-show="supportedProgram.program.push">
                        <span openlmis-message="label.allocate"></span>
                        <span ng-hide="facility.dataReportable == 'false'">
                          (<a href="" ng-click="showISAEditModal(supportedProgram)" openlmis-message="link.modify.isa"></a>)
                        </span>

                    </td>
                    <td ng-show="!supportedProgram.program.push">
                        <span openlmis-message="label.request"></span>
                    </td>
                    <td><a ng-hide="facility.dataReportable == 'false'" href="" class="close" id="remove{{$index}}" ng-click="showRemoveProgramConfirmDialog(supportedProgram)"
                           openlmis-message="create.facility.removeProgram"></a></td>
                </tr>
                <tr class="add-supported-program-row">
                    <td>
                        <select id="programs-supported" ng-model="supportedProgram.program.id"
                                ng-options="i.id as i.name for i in programsToDisplay"
                                ng-disabled="facility.dataReportable == 'false'">
                            <option value="" openlmis-message="programSupportedMessage"></option>
                        </select>
                    </td>
                    <td><input type="checkbox" ng-model="supportedProgram.active" id="supported-program-active"
                               ng-disabled="!supportedProgram.program.id"/></td>
                    <td><input type="text" id="supported-program-start-date" name="supportedProgram"
                               ng-model="supportedProgram.editedStartDate"
                               ng-change="showConfirmDateChangeWindow(supportedProgram)"
                               value="{{supportedProgram.startDate | date: 'dd/MM/yy'}}"
                               ui-date="{dateFormat:'dd/mm/yy', changeYear: true}"
                               ng-disabled="!supportedProgram.program.id"/>
            <span class="field-error" ng-show="showDateNotEnteredError"
                  openlmis-message="create.facility.mandatoryStartDate">
            </span>
                    </td>
                    <td></td>
                    <td><input type="button" class="btn btn-primary" id="supported-program-add"
                               openlmis-message="button.add"
                               ng-disabled="!supportedProgram.program.id"
                               ng-click="addSupportedProgram(supportedProgram)"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="programProductISA" modal="programProductsISAModal" options="{'backdrop':'static', 'escape':false}"
     ng-controller="IsaModalController">
  <form name="IsaProductListForm">
    <div class="modal-header">
      <h3>
        <span openlmis-message="label.isa.header"></span>
        <span ng-bind="currentProgram.name"></span>
      </h3>
    </div>

    <div class="modal-body">
      <div ng-hide="currentProgramProducts.length > 0" openlmis-message="message.no.products.mapped" class="alert alert-info"></div>
      <div ng-show="currentProgramProducts.length > 0" >
        <div class="row-fluid">
          <div class="pull-right">
            <input id="searchProduct" class="search-query" type="text" ng-model="query" ng-change="updateCurrentProgramProducts()"
                   openlmis-message="placeholder.filter.products" />
          </div>
        </div>
        <div id="overrideIsaTable">
          <div class="list-header-container">
            <div class="row-fluid list-header">
              <div class="span4">
                <span class="first-column" openlmis-message="label.product"></span>
              </div>
              <div class="span2" openlmis-message="label.calculated.isa"></div>
              <div class="span3" openlmis-message="label.overridden.isa"></div>
              <div class="span3"></div>
            </div>
          </div>

          <div class="list-container">
            <div ng-class="{'has-overridden-isa': programProduct.overriddenIsa != null || programProduct.overriddenIsa != undefined}"
                 ng-repeat="programProduct in filteredProducts">
              <div class="row-fluid list-row">
                <div class="span4">
                  <span class="first-column" id="product-name{{$index}}" ng-bind="programProduct.product.primaryName"></span>
                </div>
                <div class="span2">
                  <span id="calculated-isa{{$index}}"ng-bind="programProduct.calculatedIsa"></span>
                </div>
                <div class="span3" ng-form="overrideForm">
                  <input id="override-isa{{$index}}" name="overrideISA{{$index}}" type="text" ng-model="programProduct.overriddenIsa"
                         numeric-validator="numericValue" maxlength="6"/>

                  <span id="overrideISA{{$index}}" class="form-error" ng-show="overrideForm.overriddenISA.$error.numeric"
                        openlmis-message="error.enter.numeric.value" style="display:none;"></span>
                </div>
                <div class="span3 use-calculated-isa-column">
                  <input ng-show="programProduct.overriddenIsa != null || programProduct.overriddenIsa != undefined"
                         class="btn" id="use-calculated-button{{$index}}" ng-click="programProduct.overriddenIsa = null" type="button"
                         openlmis-message="button.use.calculated"/>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <input type="button" class="btn btn-primary" openlmis-message="button.done" ng-click="updateISA()"/>
      <input type="button" class="btn btn-cancel" openlmis-message="button.cancel" ng-click="resetISAModal()"/>
      <input type="button" ng-show="currentProgramProducts.length > 0" class="btn btn-warning pull-right"
             openlmis-message="button.use.all.calculated" ng-click="resetAllToCalculatedIsa()"/>
    </div>

  </form>
</div>

<!-- /form-group -->

<div class="form-group">
    <h3 openlmis-message="create.facility.geographicalInformation"></h3>

  <div class="form-row clearfix">
    <div class="form-cell">
      <label for="geographic-zone" openlmis-message="create.facility.geographicZone"><span class="label-required"> *</span></label>

            <div class="form-field">
                <select id="geographic-zone" name="geographicZone" ng-model="facility.geographicZone.code"
                        ng-options="i.code as i.name for i in geographicZones" ng-required="true"
                        ng-disabled="facility.dataReportable == 'false'">
                    <option value="" openlmis-message="create.facility.select.geographicZone"></option>
                </select>
        <span class="field-error" ng-show="facilityForm.geographicZone.$error.required && showError"
              openlmis-message="select.value">
        </span>
            </div>
        </div>

        <div class="form-cell">
            <label for="catchment-population" openlmis-message="create.facility.catchmentPopulation"></label>

            <div class="form-field">
                <input ng-model="facility.catchmentPopulation" id="catchment-population" ng-pattern="/^\d{1,9}$/"
                       name="catchmentPopulation" type="text" maxlength="9"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.catchmentPopulation.$error.pattern"
              openlmis-message="integer.value">
        </span>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="latitude" openlmis-message="create.facility.latitude"></label>

            <div class="form-field">
                <input ng-model="facility.latitude" ng-pattern="/^[+-]?0*\d{0,3}(\.\d{1,5}0*)?$/" id="latitude"
                       type="text"
                       name="latitude" ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.latitude.$error.pattern"
              openlmis-message="create.facility.latitude.value">
        </span>
            </div>
        </div>

        <div class="form-cell">
            <label for="longitude" openlmis-message="create.facility.longitude"></label>

            <div class="form-field">
                <input ng-model="facility.longitude" ng-pattern="/^[+-]?0*\d{0,3}(\.\d{1,5}0*)?$/" name="longitude"
                       id="longitude"
                       type="text" ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.longitude.$error.pattern"
              openlmis-message="create.facility.longitude.value">
        </span>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="altitude" openlmis-message="create.facility.altitude"></label>

            <div class="form-field">
                <input ng-model="facility.altitude" ng-pattern="/^[+-]?0*\d{0,4}(\.\d{1,4}0*)?$/" name="altitude"
                       id="altitude"
                       type="text" maxlength="9" ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.altitude.$error.pattern"
              openlmis-message="create.facility.altitude.value">
        </span>
            </div>
        </div>
    </div>
</div>
<!-- /form-group -->

<div class="form-group">
    <h3 openlmis-message="create.facility.otherInformation"></h3>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="cold-storage-gross-capacity"
                   openlmis-message="create.facility.coldStorageGrossCapacity"></label>

            <div class="form-field">
                <input ng-model="facility.coldStorageGrossCapacity" ng-pattern="/^\d{1,4}$|^\d{1,4}\.\d{1,4}$/"
                       name="coldStorageGrossCapacity" id="cold-storage-gross-capacity" type="text" maxlength="9"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.coldStorageGrossCapacity.$error.pattern"
              openlmis-message="create.facility.coldStorageCapacity.value">
        </span>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label for="cold-storage-net-capacity" openlmis-message="create.facility.coldStorageNetCapacity"></label>

            <div class="form-field">
                <input ng-model="facility.coldStorageNetCapacity" id="cold-storage-net-capacity"
                       ng-pattern="/^\d{1,4}$|^\d{1,4}\.\d{1,4}$/" name="coldStorageNetCapacity" maxlength="9"
                       type="text"
                       ng-disabled="facility.dataReportable == 'false'"/>
        <span class="field-error" ng-show="facilityForm.coldStorageNetCapacity.$error.pattern"
              openlmis-message="create.facility.coldStorageCapacity.value">
        </span>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label openlmis-message="create.facility.electricityAvailable"></label>

            <div class="form-field radio-group">
                <input ng-model="facility.hasElectricity" type="radio" name="has-electricity" value="true"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.yes"></strong>
                &nbsp; &nbsp; &nbsp;
                <input ng-model="facility.hasElectricity" type="radio" name="has-electricity" value="false"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.no"></strong>
            </div>
        </div>

        <div class="form-cell">
            <label openlmis-message="create.facility.internetConnection"></label>

            <div class="form-field radio-group">
                <input ng-model="facility.online" type="radio" name="is-online" value="true"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.yes"></strong>
                &nbsp;
                &nbsp;
                &nbsp;
                <input ng-model="facility.online" type="radio" name="is-online" value="false"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.no"></strong>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label openlmis-message="create.facility.electronicSCC"></label>

            <div class="form-field radio-group">
                <input ng-model="facility.hasElectronicScc" type="radio" name="has-electronic-scc"
                       value="true" ng-disabled="facility.dataReportable == 'false'"/><strong
                    openlmis-message="button.yes"></strong> &nbsp; &nbsp; &nbsp;
                <input ng-model="facility.hasElectronicScc" type="radio" name="has-electronic-scc"
                       value="false" ng-disabled="facility.dataReportable == 'false'"/><strong
                    openlmis-message="button.no"></strong>
            </div>
        </div>

        <div class="form-cell">
            <label openlmis-message="create.facility.electronicDAR"></label>

            <div class="form-field radio-group">
                <input ng-model="facility.hasElectronicDar" type="radio" name="has-electronic-dar"
                       value="true" ng-disabled="facility.dataReportable == 'false'"/><strong
                    openlmis-message="button.yes"></strong> &nbsp; &nbsp; &nbsp;
                <input ng-model="facility.hasElectronicDar" type="radio" name="has-electronic-dar"
                       value="false" ng-disabled="facility.dataReportable == 'false'"/><strong
                    openlmis-message="button.no"></strong>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell">
            <label openlmis-message="create.facility.dataReportable"></label>
            <ng-switch on="facility.dataReportable">
                <span ng-switch-when="true" openlmis-message="button.yes"></span>
                <span ng-switch-when="false" openlmis-message="button.no"></span>
            </ng-switch>
        </div>

        <div class="form-cell">
            <label openlmis-message="create.facility.suppliesOthers"></label>

            <div class="form-field radio-group">
                <input ng-model="facility.suppliesOthers" type="radio" name="supplies-others" value="true"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.yes"></strong>
                &nbsp; &nbsp; &nbsp;
                <input ng-model="facility.suppliesOthers" type="radio" name="supplies-others" value="false"
                       ng-disabled="facility.dataReportable == 'false'"/><strong openlmis-message="button.no"></strong>
            </div>
        </div>
    </div>

    <div class="form-row clearfix">
        <div class="form-cell full-width">
            <label for="comments" openlmis-message="create.facility.comments"></label>

            <div class="form-field">
                <input ng-model="facility.comment" id="comments" type="text" maxlength="500"
                       ng-disabled="facility.dataReportable == 'false'"/>
            </div>
        </div>
    </div>
</div>
<!-- /form-group -->

<div form-toolbar id="action_buttons" class="action-buttons">
    <div class="form-cell button-row" ng-show="facility.dataReportable == 'true'">
        <input type="submit" id="save-button" class="btn btn-primary save-button" openlmis-message="button.save"/>
        <a href="" class="btn btn-danger delete-button" ng-show="facility.id!=null"
           ng-click="showConfirmFacilityDeleteWindow()" openlmis-message="button.delete"></a>
    </div>
    <div class="form-cell button-row" ng-show="facility.dataReportable == 'false'">
        <a href="" class="btn btn-primary save-button" ng-show="facility.id!=null"
           ng-click="showConfirmFacilityRestore()"
           openlmis-message="button.restore"></a>
    </div>

    <div class="toolbar-error" id="saveErrorMsgDiv">
        <span openlmis-message="error" ng-show="error"></span>&nbsp;
        <span ng-show="errorProgram" ng-bind="errorProgram"></span>
    </div>
    <div class="toolbar-success" id="saveSuccessMsgDiv" openlmis-message="message" ng-show="message"></div>
</div>

</div>

</form>
</div>


